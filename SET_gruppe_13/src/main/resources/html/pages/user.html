<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="../css/style.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
  <header>
    <header class="grid-header">
      <nav id="mobile-nav">
        <a href="../../index.html"><img src="../ressurser/logo1.jpg" id="header-logo" alt="header-logo"></a>
        <ul>
            <li><a href="../index.html" id="current-page" style="color: black;">Produkter</a></li>
            <li><a href="login.html" style="color: black;">Logg inn</a></li>
            <li><a href="about.html" style="color: black;">Om oss</a></li>
            <li><a href="about.html#contact-form" id="contact-btn" style="color: black;">Kontakt</a></li>
        </ul>
    </nav>
    </header>
  </header>
<div class="mt-5 container">
  <h1>User Profile</h1>
  <p class="name"></p>
  <p class="email"></p>
  <p class="mobile"></p>
  <p class="adresse"></p>
  <p class="postnummer"></p>
  <a type="button" class="btn btn-primary logout" onclick="logout()">Logout</a>
</div>
</body>
<script>


  let user = null;      // Holds the fetched user data
  var loading = true;  // Shows loading state
  var error = null;     // Shows error message if the fetch fails
  const queryString = document.location.search;
  const params = new URLSearchParams(queryString);
  const id = params.get("id");
  console.log(id);

  if (!id) {
    document.location.href = "login.html";

  }

  fetchUserData(id);

  // Function to fetch user data based on ID
  async function fetchUserData(userId) {
    try {
      const response = await fetch(`../../api/users/id/${userId}`); // Use `userId` in the fetch URL
      console.log(userId);
      if (!response.ok) {
        throw new Error('Failed to fetch user data');
      }
      let user = await response.json(); // Parse and store the JSON response
      console.log(user);
      let name = document.querySelector(".name");
      name.innerHTML = `${ user.firstName}  ${ user.lastName}`;
      let email = document.querySelector(".email");
      email.innerHTML = `${ user.email} `;
      let mobile = document.querySelector(".mobile");
      mobile.innerHTML = `${ user.mobile} `;
      let adresse = document.querySelector(".adresse");
      adresse.innerHTML = `${  user.address.adresse } `;
      let postnummer = document.querySelector(".postnummer");
      postnummer.innerHTML = `${  user.address.postnummer } `;
    } catch (error) {
      this.error = error.message; // Set error message if something goes wrong
    } finally {
      this.loading = false; // Stop the loading spinner
    }
  }

 function logout() {
    fetch('/api/authenticate/logout', {
        method: 'POST',
        credentials: 'include'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            localStorage.removeItem('userId');
            window.location.href = '/pages/login.html';
        } else {
            alert(data.message);
        }
    })
    .catch(error => {
        console.error('Logout error:', error);
    });
}
</script>

</html>